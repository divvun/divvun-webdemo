"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===void 0){var parent=Object.getPrototypeOf(object);if(null===parent)return void 0;return get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return call&&("object"==typeof call||"function"==typeof call)?call:self}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var debug="file:"===window.location.protocol,log=debug?console.log.bind(window.console):function(){},DEFAULT_LANG="sme",l10n=function l10n(){return void 0===document.l10n&&console.error("l20n.js failed?"),document.l10n},Inline=Quill.import("blots/inline");var ErrorBlot=function(_Inline){function ErrorBlot(){return _classCallCheck(this,ErrorBlot),_possibleConstructorReturn(this,(ErrorBlot.__proto__||Object.getPrototypeOf(ErrorBlot)).apply(this,arguments))}return _inherits(ErrorBlot,_Inline),_createClass(ErrorBlot,[{key:"showrep",value:function showrep(a,b){var c=$(this.domNode).offset(),d={top:c.top+20,left:c.left},f=$("#repmenu"),g=f.offset().top==d.top&&f.offset().left==d.left;f.is(":visible")&&g?hiderep():(f.show(),f.offset(d),!g&&this.makerepmenu(a,b))}},{key:"makerepmenu",value:function makerepmenu(a,b){var c=this.domNode,d=$(c).data("error");$("#repmenu_tbl").empty();var f=$(document.createElement("tbody"));f.attr("role","listbox"),""==d.msg&&(d.msg="Ukjend feiltype");var g=$(document.createElement("tr")),h=$(document.createElement("td")),j=$(document.createElement("span"));j.html(d.msg),j.attr("aria-disabled","true"),h.append(j),h.addClass("repmenu_msg"),g.append(h),f.append(g),d.rep.map(function(k){var l=$(document.createElement("tr")),m=$(document.createElement("td")),n=$(document.createElement("a"));""==k?n.text("(fjern)"):n.text(k.replace(/ /g,"\xA0")),(0==k.lastIndexOf(" ",0)||k.indexOf(" ",k.length-1)==k.length-1)&&n.addClass("hl-space"),n.attr("role","option"),m.append(n),m.addClass("repmenu_rep"),m.addClass("repmenu_nonfirst"),m.click({beg:a,len:b,r:k},replaceErr),l.append(m),f.append(l)}),$("#repmenu_tbl").append(f)}}],[{key:"create",value:function create(a){var b=_get(ErrorBlot.__proto__||Object.getPrototypeOf(ErrorBlot),"create",this).call(this);return"object"==("undefined"==typeof a?"undefined":_typeof(a))?($(b).data("error",a),$(b).addClass("class","error-blue"),b):(console.log("Error creating ErrorBlot, expected object, not "+("undefined"==typeof a?"undefined":_typeof(a))),_get(ErrorBlot.__proto__||Object.getPrototypeOf(ErrorBlot),"create",this).call(this))}},{key:"formats",value:function formats(a){return $(a).data("error")}}]),ErrorBlot}(Inline);ErrorBlot.blotName="error",ErrorBlot.tagName="span",ErrorBlot.className="error",Quill.register(ErrorBlot);var replaceErr=function replaceErr(a){hiderep();var b={ops:[{retain:a.data.beg},{delete:a.data.len},{insert:a.data.r}]};quill.updateContents(b,"user"),atMostOneSpace(a.data.beg),checkOnIdle(2000),quill.focus()},hiderep=function hiderep(){var a=$("#repmenu");a.offset({top:0,left:0}),a.hide()},onSelectionChange=function onSelectionChange(a,b,c){if(null!=a&&0===a.length&&"user"===c){var d=quill.scroll.descendant(ErrorBlot,a.index),f=d[0],g=d[1];if(null!=f)if($(f.domNode).data("error")){var h=a.index-g,j=f.length();f.showrep(h,j)}else console.log("descendant ErrorBlot at",a.index,"had no data, clearing markup"),quill.formatText(a.index-g,f.length(),"error",!1)}},atMostOneSpace=function atMostOneSpace(a){for(var b=getFText();" "==b[a-1];)a--;for(var c=0;" "==b[a+c];)c++;1<c&&quill.deleteText(a,c-1,"user")},clearErrs=function clearErrs(){quill.formatText(0,quill.getLength(),"error",!1)},applyErrs=function applyErrs(a,b){b.errs.forEach(function(c){var d=c[2]-c[1];log(c),quill.formatText(c[1],d,"error",{str:c[0],beg:c[1],end:c[2],len:d,typ:c[3],rep:c[5],msg:c[4]})}),log(b)},toolbarOptions=[[{header:[1,2,3,!1]}],["bold","italic","underline"],["link"],[{list:"ordered"},{list:"bullet"}],["clean"],["check"]],quill=new Quill("#editor",{modules:{toolbar:{container:toolbarOptions,handlers:{check:function check(a){_check()}}}},theme:"snow",placeholder:"\u010C\xE1lis d\xE1sa, dahje v\xE1lljes ovdmearkka d\xE1s vuol\xE1bealde"}),getFText=function getFText(){return quill.getContents().ops.map(function(a){return"string"==typeof a.insert?a.insert:" "}).join("")},searchToObject=function searchToObject(){var a=window.location.search.substring(1).split("&"),b={};for(var c in a)if(-1<a[c].indexOf("=")){var d=a[c].split("="),f=d[0],g=d[1].replace(/\+/g,"%20");b[decodeURIComponent(f)]=decodeURIComponent(g)}return b},port="file:"===window.location.protocol?"2737":window.location.port,hostname=""===window.location.hostname?"localhost":window.location.hostname,protocol="file:"===window.location.protocol?"http:":window.location.protocol,subdir="file:"===window.location.protocol?"":"/apy",checkUrl=protocol+"//"+hostname+":"+port.toString()+subdir+"/translateRaw";log(checkUrl),$(document).ready(function(){if(window.location.host.match("^localhost:")){console.log("Connecting to skewer \u2026");var a=document.createElement("script");a.src="http://localhost:38495/skewer",document.body.appendChild(a)}});var hideLogin=function hideLogin(){$("#serverfault").hide(),$("#loginform").hide(),$("#content").removeClass("blur"),$("#login-wrapper").removeClass("block-view"),$("#logout").show()},showLogin=function showLogin(){$("#loginform").show(),$("#content").addClass("blur"),$("#login-wrapper").addClass("block-view"),$("#logout").hide()};function utoa(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(b,c){return String.fromCharCode(parseInt("0x"+c))}))}var basicAuthHeader=function basicAuthHeader(a){return null==a?($("#serverfault").html("\u010C\xE1llet go beassans\xE1ni boastut?"),$("#serverfault").show(),showLogin(),"Basic TODO"):"Basic "+utoa(a.u+":"+a.p)},langToMode=function langToMode(a){return a+"|"+a+"_gram"},checkXHR=null,servercheck=function servercheck(a,b,c,d){log("servercheck:"),null!=checkXHR&&checkXHR.abort(),checkXHR=$.ajax({beforeSend:function beforeSend(f){f.setRequestHeader("Authorization",basicAuthHeader(a))},type:"POST",url:checkUrl,data:{langpair:langToMode(d),q:b},success:function success(f){c(b,f)},error:function error(f,g,h){console.log("error: "+g+"\n"+h),console.log(f),console.log(f.status),"abort"===g&&0===f.status||("error"===g&&0===f.status?l10n().formatValue("serverdown").then(function(j){$("#serverfault").html(j).show()}):(l10n().formatValue("loginfail",{errorCode:f.status+" "+h,textStatus:g}).then(function(j){$("#serverfault").html(j).show()}),$("#serverfault").show(),showLogin()))},dataType:"json"})},supportedLangs=["sme","fao"],getLang=function getLang(a){return void 0===a.lang?DEFAULT_LANG:a.lang},_check=function _check(){var a=getLang(searchToObject());clearErrs();var b=getFText();window.localStorage.text=JSON.stringify(quill.getContents());var c=safeGetItem("userpass",readLoginFormStoring());null==c?showLogin():servercheck(c,b,applyErrs,a)},readLoginFormStoring=function readLoginFormStoring(){var a={u:$("#user").val(),p:$("#password").val()};return""!=a.u&&""!=a.p?(window.localStorage.setItem("userpass",JSON.stringify(a)),a):null},loginFromForm=function loginFromForm(){var a=readLoginFormStoring();return null!=a&&hideLogin(),!1},loginOnEnter=function loginOnEnter(a){13==a.which&&loginFromForm()},loginOnClick=function loginOnClick(a){return loginFromForm(),!1},idleTimer=null,checkOnIdle=function checkOnIdle(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:3000;window.clearTimeout(idleTimer),idleTimer=window.setTimeout(_check,a)},onTextChange=function onTextChange(a,b,c){"api"==c||"user"==c&&(hiderep(),checkOnIdle())},logout=function logout(a){return showLogin(),window.localStorage.removeItem("userpass"),$("#user").val(""),$("#password").val(""),!1},initSpinner=function initSpinner(){$("#spinner").hide(),$("#editor").removeClass("loading"),$(document).ajaxStart(function(){$("#spinner").show(),$("#editor").addClass("loading"),$(".ql-check").addClass("glyphicon glyphicon-refresh spinning"),$(".ql-check").addClass("loading-check")}).ajaxStop(function(){$("#spinner").hide(),$("#editor").removeClass("loading"),$(".ql-check").removeClass("glyphicon glyphicon-refresh spinning"),$(".ql-check").removeClass("loading-check")})},safeGetItem=function safeGetItem(a,b){var c=window.localStorage.getItem(a);if(null==c)return b;try{var d=JSON.parse(c);if(null!=d)return d}catch(f){console.log(f)}return b},initExamples=function initExamples(){var a=[];for(var b=1;20>=b;b++)a.push("example"+b.toString()+"_title"),a.push("example"+b.toString());l10n().formatValues.apply(l10n(),a).then(function(c){var d=[],f=[];for(var g=0;g<c.length;g++)0==g%2?d.push(c[g]):f.push(c[g]);for(g=0;g<d.length;g++)if(!d[g].match(/^example[0-9]+_title$|^$/)){var h=$(document.createElement("button"));h.text(d[g]),h.attr("type","button"),h.addClass("btn btn-default"),$(h).click({text:f[g]},function(j){quill.setContents({ops:[{insert:j.data.text}]}),_check()}),$("#examples").append(h),$("#examples").append(" ")}})},initL10n=function initL10n(a){l10n().requestLanguages([a]),l10n().formatValue("editor_placeholder").then(function(c){$(".ql-editor").attr("data-placeholder",c)});var b=$("<link/>");b.attr("rel","stylesheet"),b.attr("href","locales/"+a+".css"),$("head").append(b)},init=function init(){"http:"==window.location.protocol&&$("#password").attr("type","text"),$("#login_b").click(loginOnClick),$("#password").keypress(loginOnEnter),$("#user").keypress(loginOnEnter),$("#logout_b").click(logout),$("#editor").click(hiderep),$("body").click(hiderep),initSpinner();var a=searchToObject();initL10n(getLang(a)),initExamples(),$.ajaxSetup({statusCode:{"401":function _(){showLogin()}}}),quill.on("text-change",onTextChange),quill.on("selection-change",onSelectionChange);var b={ops:[]};a.q===void 0?b=safeGetItem("text",b):(b={ops:[{insert:a.q}]},window.location.search=""),quill.setContents(b),clearErrs(),hiderep(),_check()};$(document).ready(init);
//# sourceMappingURL=app.js.map